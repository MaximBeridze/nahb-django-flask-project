{% extends "base.html" %}
{% block content %}
<h1>Moderation</h1>

<h3>Stories</h3>
<table class="table">
  <tr><th>ID</th><th>Title</th><th>Status</th><th>Set status</th></tr>
  {% for s in stories %}
    <tr>
      <td>{{ s.id }}</td>
      <td>{{ s.title }}</td>
      <td>{{ s.status }}</td>
      <td>
        <form class="row" method="post" action="{% url 'set_story_status' s.id %}">
          {% csrf_token %}
          <select name="status">
            <option value="draft" {% if s.status == "draft" %}selected{% endif %}>draft</option>
            <option value="published" {% if s.status == "published" %}selected{% endif %}>published</option>
            <option value="suspended" {% if s.status == "suspended" %}selected{% endif %}>suspended</option>
          </select>
          <button class="btn small">Update</button>
        </form>
      </td>
    </tr>
  {% endfor %}
</table>

<h3>Reports</h3>
<table class="table">
  <tr><th>Date</th><th>User</th><th>Story</th><th>Reason</th><th>Status</th></tr>
  {% for r in reports %}
    <tr>
      <td>{{ r.created_at }}</td>
      <td>{{ r.user.username }}</td>
      <td>#{{ r.story_id }}</td>
      <td>{{ r.reason|linebreaksbr }}</td>
      <td>
        {% if r.resolved %}
          <span class="pill">resolved</span>
        {% else %}
          <form method="post" action="{% url 'resolve_report' r.id %}">
            {% csrf_token %}
            <button class="btn small secondary">Mark resolved</button>
          </form>
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="5" class="muted">No reports.</td></tr>
  {% endfor %}
</table>
{% endblock %}
